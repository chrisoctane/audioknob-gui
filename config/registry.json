{
  "schema": 1,
  "knobs": [
    {
      "id": "audio_group_membership",
      "title": "Join audio groups",
      "description": "Adds current user to audio-related groups (audio, realtime, pipewire). Required for RT limits and low-latency audio. Requires logout/login to take effect.",
      "category": "permissions",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "group_membership",
        "params": {
          "groups": ["audio", "realtime", "pipewire"]
        }
      }
    },
    {
      "id": "rt_limits_audio_group",
      "title": "Realtime limits for @audio",
      "description": "Allows audio apps in the 'audio' group to request realtime priority (rtprio 95), lock memory (memlock unlimited), and use nice -10. Essential for low-latency audio.",
      "category": "permissions",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": ["audio", "realtime"],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "pam_limits_audio_group",
        "params": {
          "path": "/etc/security/limits.d/99-audioknob-gui.conf",
          "lines": [
            "@audio   -  rtprio     95",
            "@audio   -  memlock    unlimited",
            "@audio   -  nice      -10"
          ]
        }
      }
    },
    {
      "id": "irqbalance_disable",
      "title": "Disable irqbalance",
      "description": "Stops irqbalance service so audio IRQs don't get moved between CPUs unexpectedly. Reduces latency jitter.",
      "category": "irq",
      "risk_level": "medium",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "systemd_unit_toggle",
        "params": {"unit": "irqbalance.service", "action": "disable_now"}
      }
    },
    {
      "id": "rtirq_enable",
      "title": "Enable rtirq service",
      "description": "Enables rtirq service which sets high realtime priorities for audio-related IRQ threads. File: /etc/sysconfig/rtirq or /etc/rtirq.conf.",
      "category": "irq",
      "risk_level": "medium",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "cpu_governor_performance_temp",
      "title": "CPU governor: performance",
      "description": "Sets CPU frequency governor to 'performance' (until reboot). Prevents CPU frequency scaling which can cause latency spikes. File: /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor",
      "category": "cpu",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "sysfs_glob_kv",
        "params": {
          "glob": "/sys/devices/system/cpu/cpu*/cpufreq/scaling_governor",
          "value": "performance"
        }
      }
    },
    {
      "id": "cpu_dma_latency_udev",
      "title": "CPU DMA latency udev rule",
      "description": "Creates udev rule to allow audio group write access to /dev/cpu_dma_latency. Enables apps to request low C-state latency. File: /etc/udev/rules.d/99-cpu-dma-latency.rules",
      "category": "cpu",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": ["audio", "realtime"],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "swappiness",
      "title": "Reduce swappiness",
      "description": "Sets vm.swappiness=10 to reduce swapping, avoiding latency spikes under memory pressure. File: /etc/sysctl.d/99-audioknob-gui.conf",
      "category": "vm",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "sysctl_conf",
        "params": {
          "path": "/etc/sysctl.d/99-audioknob-gui.conf",
          "lines": ["vm.swappiness=10"]
        }
      }
    },
    {
      "id": "thp_mode_madvise",
      "title": "THP: madvise mode",
      "description": "Sets Transparent Huge Pages to 'madvise' mode. Recommended for latency-sensitive audio workloads. File: /sys/kernel/mm/transparent_hugepage/enabled",
      "category": "vm",
      "risk_level": "medium",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "sysfs_glob_kv",
        "params": {
          "glob": "/sys/kernel/mm/transparent_hugepage/enabled",
          "value": "madvise"
        }
      }
    },
    {
      "id": "inotify_max_watches",
      "title": "Increase inotify watches",
      "description": "Sets fs.inotify.max_user_watches=600000 for DAWs that watch many files. Prevents 'too many open files' errors. File: /etc/sysctl.d/99-audioknob-gui.conf",
      "category": "vm",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "dirty_bytes",
      "title": "Reduce dirty writeback",
      "description": "Lowers vm.dirty_bytes and vm.dirty_background_bytes to reduce I/O latency from writeback. File: /etc/sysctl.d/99-audioknob-gui.conf",
      "category": "vm",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "usb_autosuspend_disable",
      "title": "Disable USB autosuspend",
      "description": "Disables USB autosuspend to prevent USB audio device dropouts. Creates udev rule. File: /etc/udev/rules.d/99-usb-no-autosuspend.rules",
      "category": "power",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "kernel_threadirqs",
      "title": "Enable threaded IRQs",
      "description": "Adds 'threadirqs' to kernel cmdline. Makes IRQ handlers schedulable for better RT performance. Requires reboot. File: /etc/kernel/cmdline (openSUSE TW) or /etc/default/grub",
      "category": "kernel",
      "risk_level": "medium",
      "requires_root": true,
      "requires_reboot": true,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "kernel_audit_off",
      "title": "Disable kernel audit",
      "description": "Adds 'audit=0' to kernel cmdline. Reduces overhead from audit subsystem. Requires reboot. File: /etc/kernel/cmdline or /etc/default/grub",
      "category": "kernel",
      "risk_level": "medium",
      "requires_root": true,
      "requires_reboot": true,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "kernel_mitigations_off",
      "title": "Disable CPU mitigations",
      "description": "Adds 'mitigations=off' to kernel cmdline. SECURITY TRADEOFF: Improves performance but disables Spectre/Meltdown protections. Requires reboot.",
      "category": "kernel",
      "risk_level": "high",
      "requires_root": true,
      "requires_reboot": true,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "qjackctl_server_prefix_rt",
      "title": "QjackCtl: realtime flags",
      "description": "Ensures QjackCtl Server line has -R (realtime) flag. Optional: taskset for CPU pinning. File: ~/.config/rncbc.org/QjackCtl.conf",
      "category": "stack",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": ["audio", "realtime"],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": {
        "kind": "qjackctl_server_prefix",
        "params": {
          "path": "~/.config/rncbc.org/QjackCtl.conf",
          "ensure_rt": true,
          "ensure_priority": false,
          "cpu_cores": null
        }
      }
    },
    {
      "id": "pipewire_quantum",
      "title": "PipeWire quantum (buffer)",
      "description": "Configures PipeWire buffer size (quantum). Lower = less latency, more CPU. File: ~/.config/pipewire/pipewire.conf.d/99-audioknob.conf",
      "category": "stack",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "pipewire_sample_rate",
      "title": "PipeWire sample rate",
      "description": "Configures PipeWire default sample rate (44100, 48000, 96000). File: ~/.config/pipewire/pipewire.conf.d/99-audioknob.conf",
      "category": "stack",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "disable_tracker",
      "title": "Disable GNOME tracker",
      "description": "Disables tracker-miner-fs (file indexer) which causes latency spikes. GNOME desktops only.",
      "category": "services",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "disable_baloo",
      "title": "Disable KDE Baloo",
      "description": "Disables Baloo file indexer (KDE) which causes latency spikes. KDE desktops only.",
      "category": "services",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": true, "restore": true},
      "impl": null
    },
    {
      "id": "stack_detect",
      "title": "Audio stack info",
      "description": "Shows what audio server is active: PipeWire, JACK, or ALSA only. Also lists ALSA playback devices.",
      "category": "testing",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": false, "restore": false},
      "impl": {"kind": "read_only", "params": {"what": "stack_detect"}}
    },
    {
      "id": "scheduler_jitter_test",
      "title": "Scheduler jitter test",
      "description": "Runs cyclictest to measure scheduler latency jitter. Shows max latency in microseconds. Lower is better. Requires cyclictest package.",
      "category": "testing",
      "risk_level": "low",
      "requires_root": true,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": false, "restore": false},
      "impl": {"kind": "read_only", "params": {"what": "cyclictest"}}
    },
    {
      "id": "blocker_check",
      "title": "Check blockers",
      "description": "Checks for common issues: not in audio group, missing packages, wrong kernel, etc.",
      "category": "testing",
      "risk_level": "low",
      "requires_root": false,
      "requires_reboot": false,
      "requires_groups": [],
      "capabilities": {"read": true, "apply": false, "restore": false},
      "impl": null
    }
  ]
}
