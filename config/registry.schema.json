{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.invalid/audioknob-gui/registry.schema.json",
  "title": "audioknob-gui knob registry",
  "type": "object",
  "required": ["schema", "knobs"],
  "additionalProperties": false,
  "properties": {
    "schema": {"type": "integer", "const": 1},
    "knobs": {
      "type": "array",
      "items": {"$ref": "#/$defs/knob"}
    }
  },
  "$defs": {
    "knob": {
      "type": "object",
      "required": [
        "id",
        "title",
        "description",
        "category",
        "risk_level",
        "requires_root",
        "requires_reboot",
        "requires_groups",
        "requires_commands",
        "capabilities"
      ],
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string", "pattern": "^[a-z0-9_]+$"},
        "title": {"type": "string", "minLength": 1},
        "description": {"type": "string", "minLength": 1},
        "category": {
          "type": "string",
          "enum": [
            "permissions",
            "stack",
            "device",
            "irq",
            "cpu",
            "power",
            "services",
            "vm",
            "kernel",
            "testing"
          ]
        },
        "risk_level": {"type": "string", "enum": ["low", "medium", "high"]},
        "requires_root": {"type": "boolean"},
        "requires_reboot": {"type": "boolean"},
        "requires_groups": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User must be in at least ONE of these groups"
        },
        "requires_commands": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Commands that must be available (e.g., cyclictest)"
        },
        "depends_on": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Knob ids that must remain enabled for this knob"
        },
        "capabilities": {
          "type": "object",
          "required": ["read", "apply", "restore"],
          "additionalProperties": false,
          "properties": {
            "read": {"type": "boolean"},
            "apply": {"type": "boolean"},
            "restore": {"type": "boolean"}
          }
        },
        "notes": {"type": "string"},
        "impl": {
          "oneOf": [
            {"type": "null"},
            {
              "type": "object",
              "description": "Worker implementation hook.",
              "required": ["kind"],
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "type": "string",
                  "enum": [
                    "read_only",
                    "pam_limits_audio_group",
                    "sysctl_conf",
                    "systemd_unit_toggle",
                    "sysfs_glob_kv",
                    "qjackctl_server_prefix",
                    "udev_rule",
                    "kernel_cmdline",
                    "pipewire_conf",
                    "user_service_mask",
                    "baloo_disable",
                    "group_membership"
                  ]
                },
                "params": {"type": "object"}
              }
            }
          ]
        }
      }
    }
  }
}
